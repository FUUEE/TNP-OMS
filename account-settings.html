<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings - Tahanan ng Pagmamahal OMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-primary': '#dc2626',
                        'red-secondary': '#ef4444',
                        'red-light': '#fef2f2'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center text-gray-600 hover:text-red-primary">
                        <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back to Dashboard
                    </a>
                </div>
                <h1 class="text-xl font-semibold text-gray-900">Account Settings</h1>
                <div></div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Success/Error Messages -->
        <div id="messageContainer" class="mb-4 hidden"></div>

        <!-- Profile Information -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="p-6 border-b">
                <h2 class="text-lg font-medium text-gray-900">Profile Information</h2>
                <p class="text-sm text-gray-600">Update your account profile information.</p>
            </div>
            <div class="p-6">
                <form id="profileForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                            <input type="text" id="firstName" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                        
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                            <input type="text" id="lastName" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="email"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                        
                        <div>
                            <label for="contactNumber" class="block text-sm font-medium text-gray-700 mb-2">Contact Number</label>
                            <input type="tel" id="contactNumber"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="currentAddress" class="block text-sm font-medium text-gray-700 mb-2">Current Address</label>
                            <textarea id="currentAddress" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button type="submit" class="px-4 py-2 bg-red-primary text-white rounded-md hover:bg-red-700 transition-colors">
                            Update Profile
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Change Password -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b">
                <h2 class="text-lg font-medium text-gray-900">Change Password</h2>
                <p class="text-sm text-gray-600">Update your account password for security.</p>
            </div>
            <div class="p-6">
                <form id="passwordForm">
                    <div class="space-y-6">
                        <div>
                            <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-2">Current Password *</label>
                            <input type="password" id="currentPassword" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                        
                        <div>
                            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">New Password *</label>
                            <input type="password" id="newPassword" required minlength="6"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                            <p class="text-xs text-gray-500 mt-1">Password must be at least 6 characters long.</p>
                        </div>
                        
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password *</label>
                            <input type="password" id="confirmPassword" required minlength="6"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-primary focus:border-red-primary">
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button type="submit" class="px-4 py-2 bg-red-primary text-white rounded-md hover:bg-red-700 transition-colors">
                            Change Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Session Manager
        const sessionManager = {
            getCurrentUser: function() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            },
            
            requireLogin: function() {
                if (!localStorage.getItem('currentUser')) {
                    window.location.href = 'login.html';
                    return false;
                }
                return true;
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            if (!sessionManager.requireLogin()) {
                return;
            }

            currentUser = sessionManager.getCurrentUser();
            loadUserData();
            setupEventListeners();
        });

        function loadUserData() {
            // Load user data based on role
            if (currentUser.role === 'staff') {
                loadStaffData();
            } else if (currentUser.role === 'volunteer') {
                loadVolunteerData();
            } else {
                // Admin - load basic info
                document.getElementById('firstName').value = currentUser.name.split(' ')[0] || '';
                document.getElementById('lastName').value = currentUser.name.split(' ').slice(1).join(' ') || '';
            }
        }

        function loadStaffData() {
            const staffRecords = JSON.parse(localStorage.getItem('staff-records') || '[]');
            const staffRecord = staffRecords.find(staff => staff.username === currentUser.username);
            
            if (staffRecord) {
                document.getElementById('firstName').value = staffRecord.firstName || '';
                document.getElementById('lastName').value = staffRecord.lastName || '';
                document.getElementById('email').value = staffRecord.emailAddress || '';
                document.getElementById('contactNumber').value = staffRecord.contactNumber || '';
                document.getElementById('currentAddress').value = staffRecord.currentAddress || '';
            }
        }

        function loadVolunteerData() {
            const volunteerRecords = JSON.parse(localStorage.getItem('volunteer-records') || '[]');
            const volunteerRecord = volunteerRecords.find(volunteer => volunteer.username === currentUser.username);
            
            if (volunteerRecord) {
                document.getElementById('firstName').value = volunteerRecord.firstName || '';
                document.getElementById('lastName').value = volunteerRecord.lastName || '';
                document.getElementById('email').value = volunteerRecord.emailAddress || '';
                document.getElementById('contactNumber').value = volunteerRecord.contactNumber || '';
                document.getElementById('currentAddress').value = volunteerRecord.currentAddress || '';
            }
        }

        function setupEventListeners() {
            // Profile form submission
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateProfile();
            });

            // Password form submission
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changePassword();
            });
        }

        function updateProfile() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const contactNumber = document.getElementById('contactNumber').value.trim();
            const currentAddress = document.getElementById('currentAddress').value.trim();

            if (!firstName || !lastName) {
                showMessage('First name and last name are required.', 'error');
                return;
            }

            const fullName = `${firstName} ${lastName}`;

            // Update current user session
            currentUser.name = fullName;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            // Update records based on role
            if (currentUser.role === 'staff') {
                updateStaffRecord(firstName, lastName, email, contactNumber, currentAddress);
            } else if (currentUser.role === 'volunteer') {
                updateVolunteerRecord(firstName, lastName, email, contactNumber, currentAddress);
            }

            showMessage('Profile updated successfully!', 'success');
        }

        function updateStaffRecord(firstName, lastName, email, contactNumber, currentAddress) {
            const staffRecords = JSON.parse(localStorage.getItem('staff-records') || '[]');
            const staffIndex = staffRecords.findIndex(staff => staff.username === currentUser.username);
            
            if (staffIndex !== -1) {
                staffRecords[staffIndex].firstName = firstName;
                staffRecords[staffIndex].lastName = lastName;
                staffRecords[staffIndex].emailAddress = email;
                staffRecords[staffIndex].contactNumber = contactNumber;
                staffRecords[staffIndex].currentAddress = currentAddress;
                
                localStorage.setItem('staff-records', JSON.stringify(staffRecords));
            }
        }

        function updateVolunteerRecord(firstName, lastName, email, contactNumber, currentAddress) {
            const volunteerRecords = JSON.parse(localStorage.getItem('volunteer-records') || '[]');
            const volunteerIndex = volunteerRecords.findIndex(volunteer => volunteer.username === currentUser.username);
            
            if (volunteerIndex !== -1) {
                volunteerRecords[volunteerIndex].firstName = firstName;
                volunteerRecords[volunteerIndex].lastName = lastName;
                volunteerRecords[volunteerIndex].emailAddress = email;
                volunteerRecords[volunteerIndex].contactNumber = contactNumber;
                volunteerRecords[volunteerIndex].currentAddress = currentAddress;
                
                localStorage.setItem('volunteer-records', JSON.stringify(volunteerRecords));
            }
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showMessage('All password fields are required.', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showMessage('New passwords do not match.', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showMessage('New password must be at least 6 characters long.', 'error');
                return;
            }

            // Verify current password
            if (!verifyCurrentPassword(currentPassword)) {
                showMessage('Current password is incorrect.', 'error');
                return;
            }

            // Update password based on role
            if (currentUser.role === 'staff') {
                updateStaffPassword(newPassword);
            } else if (currentUser.role === 'volunteer') {
                updateVolunteerPassword(newPassword);
            } else {
                // Admin password update would go here
                showMessage('Password change not available for admin accounts.', 'error');
                return;
            }

            // Clear form
            document.getElementById('passwordForm').reset();
            showMessage('Password changed successfully!', 'success');
        }

        function verifyCurrentPassword(currentPassword) {
            if (currentUser.role === 'staff') {
                const staffRecords = JSON.parse(localStorage.getItem('staff-records') || '[]');
                const staffRecord = staffRecords.find(staff => staff.username === currentUser.username);
                return staffRecord && staffRecord.password === currentPassword;
            } else if (currentUser.role === 'volunteer') {
                const volunteerRecords = JSON.parse(localStorage.getItem('volunteer-records') || '[]');
                const volunteerRecord = volunteerRecords.find(volunteer => volunteer.username === currentUser.username);
                return volunteerRecord && volunteerRecord.password === currentPassword;
            }
            return false;
        }

        function updateStaffPassword(newPassword) {
            const staffRecords = JSON.parse(localStorage.getItem('staff-records') || '[]');
            const staffIndex = staffRecords.findIndex(staff => staff.username === currentUser.username);
            
            if (staffIndex !== -1) {
                staffRecords[staffIndex].password = newPassword;
                localStorage.setItem('staff-records', JSON.stringify(staffRecords));
            }
        }

        function updateVolunteerPassword(newPassword) {
            const volunteerRecords = JSON.parse(localStorage.getItem('volunteer-records') || '[]');
            const volunteerIndex = volunteerRecords.findIndex(volunteer => volunteer.username === currentUser.username);
            
            if (volunteerIndex !== -1) {
                volunteerRecords[volunteerIndex].password = newPassword;
                localStorage.setItem('volunteer-records', JSON.stringify(volunteerRecords));
            }
        }

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const bgColor = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
            
            container.innerHTML = `
                <div class="${bgColor} px-4 py-3 rounded border">
                    ${message}
                </div>
            `;
            container.classList.remove('hidden');
            
            setTimeout(() => {
                container.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
